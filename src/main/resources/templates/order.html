<html xmlns="http://www.w3.org/1999/xhtml">
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>我是买家</title>
    <link href="css/top.css" rel="stylesheet" type="text/css"/>
    <link href="css/order.css" rel="stylesheet" type="text/css"/>
    <link href="css/bottom.css" rel="stylesheet" type="text/css"/>
    <script src="js/jquery.min.js"></script>
    <script src="js/layer.js"></script>
    <script type="text/javascript">
        $(function () {
            $(".state").change(function () {
                window.location.href = "order?state=" + $(this).val();
            });
            $(".query").click(function () {
                window.location.href = "findBuiedgoods?uid=" + $("#uid").val() + "&gid=" + $(this).attr("item-id");
            });
            var result = $("#hid").val();
            if (result == "" || result == null) {
                $("#a").attr("selected", "selected");
                $("#b").removeAttribute("selected");
                $("#c").removeAttribute("selected");
                $("#d").removeAttribute("selected");
                $("#e").removeAttribute("selected");
                $("#f").removeAttribute("selected");

            }
            if (result == 0) {
                $("#b").attr("selected", "selected");
                $("#a").removeAttribute("selected");
                $("#c").removeAttribute("selected");
                $("#d").removeAttribute("selected");
                $("#e").removeAttribute("selected");
                $("#f").removeAttribute("selected");

            }
            if (result == 1) {
                $("#c").attr("selected", "selected");
                $("#a").removeAttribute("selected");
                $("#b").removeAttribute("selected");
                $("#d").removeAttribute("selected");
                $("#e").removeAttribute("selected");
                $("#f").removeAttribute("selected");
            }
            if (result == 2) {
                $("#d").attr("selected", "selected");
                $("#a").removeAttribute("selected");
                $("#b").removeAttribute("selected");
                $("#e").removeAttribute("selected");
                $("#f").removeAttribute("selected");
                $("#c").removeAttribute("selected");
            }
            if (result == 3) {
                $("#e").attr("selected", "selected");
                $("#a").removeAttribute("selected");
                $("#b").removeAttribute("selected");
                $("#d").removeAttribute("selected");
                $("#f").removeAttribute("selected");
                $("#c").removeAttribute("selected");
            }
            if (result == 4) {
                $("#f").attr("selected", "selected");
                $("#a").removeAttribute("selected");
                $("#b").removeAttribute("selected");
                $("#e").removeAttribute("selected");
                $("#d").removeAttribute("selected");
                $("#c").removeAttribute("selected");
            }
        })
    </script>
</head>
<body>
<div class="nav">
    <div class="nav_content">
        <div class="user">
                <th:if th:if="${session.userinfoLogins==null}">
                    <div class="car">
                        <a th:href="@{/login}"><img src="images/car.png"></a>
                        <span>0</span>
                    </div>
                </th:if>
                <th:if th:if="${session.userinfoLogins!=null}">
                    <div class="car">
                        <a th:href="@{/findShopList(userId=${session.userinfoLogins.id},pageNum=1)}"><img
                                src="images/car.png"></a>
                        <span th:text="${session.num}"></span>
                    </div>
                </th:if>
            <div class="userlogo">
                <img src="images/icon-user_47dae1a.jpg">
                <div class="user_meua">
                    <th:if th:if="${session.userinfoLogins==null}">
                        <a th:href="@{/Regedit}">立刻注册</a>
                        <a th:href="@{/login}">立刻登录</a>
                        <a th:href="@{/login}">我的订单</a>
                        <a href="#">帮助与反馈</a>
                        <a href="#">联系我们</a>
                    </th:if>
                    <th:if th:if="${session.userinfoLogins!=null}">
                        <div>
                            <a th:href="@{/goToUserCenter}">尊敬的 <b th:text="${session.userinfoLogins.userName}"></b></a>
                            <a th:href="@{/goToUserCenter}">我的资料</a>
                            <a th:href="@{/order}">我的订单</a>
                            <a th:href="@{/findShopList(userId=${session.userinfoLogins.id},pageNum=1)}">我的购物车</a>
                            <a>发布商品</a>
                            <a th:href="@{/Publishgoods}">我发布的商品</a>
                            <a th:href="@{/login2}">退出登陆</a>
                        </div>
                    </th:if>
                </div>
            </div>
            <div class="search">
                <form method="post" th:action="@{/findGoodsInfoName}">
                    <input placeholder="搜索商品" required="true" name="name" type="text" id="myword">
                    <input type="image" src="images/search.png"
                           style="float:right;margin-top:6px; margin-right:6px;width:20px;height:20px;"></form>
            </div>
        </div>
        <ul class="nav_link">
            <li><img src="images/web.gif" style="width: 200px;height:80px;margin-left: -600px;margin-top: -10px"/>
            </li>
            <li>
                <th:if th:if="${session.userinfoLogins==null}">
                    <a th:href="@{/index}">首页</a>
                </th:if>
                <th:if th:if="${session.userinfoLogins!=null}">
                    <a th:href="@{'/index?userId='+${session.userinfoLogins.id}}">首页</a>
                </th:if>
            </li>
            <li>
                <a th:href="@{/pubGoods}">发布商品</a>
            </li>
            <li>
                <a th:href="@{/findWantGoodsAll}">求购商品</a>
            </li>
            <li>
                <th:if th:if="${session.userinfoLogins!=null}">
                    <a th:href="@{/goToUserCenter}">用户中心</a>
                </th:if>
                <th:if th:if="${session.userinfoLogins==null}">
                    <a th:href="@{/login}">用户中心</a>
                </th:if>
            </li>
            <li>
                <th:if th:if="${session.userinfoLogins!=null}">
                    <a th:href="@{/findBrowser(userId=${session.userinfoLogins.id},pageNum=1)}">我的足迹</a>
                </th:if>
                <th:if th:if="${session.userinfoLogins==null}">
                    <a th:href="@{/login}">我的足迹</a>
                </th:if>
            </li>
        </ul>
    </div>
</div>
<!--==========================================================================================-->
<script src="js/jquery.min.js"></script>
<script src="js/layer.js"></script>
<!--<form id=theForm name="theForm" action="#" method="post"-->
<!--onSubmit="return Juge()">-->
<input type="hidden" id="hid" th:value="${state}"/>
<div class="main">
    <div class="main_content">
        <form class="fo" th:action="@{/orderofmai}" method="post">
            <p class="main_content_title">

                <input style="background-color:dodgerblue" type="button" value="我是买家"/>
                <input type="submit" value="我是卖家"/>

            </p>
            <ul class="main_goods_title">
                <li style="text-align:left; text-indent:25px; width: 250px">商品</li>
                <li style="width: 40px">单价</li>
                <li>联系卖家</li>
                <li>卖家状态</li>
                <li>操作</li>
                <li>订单日期</li>
                <li style="width: 100px">订单状态</li>
            </ul>
        </form>
        <ul class="main_goods_desc" th:each="pdd : ${pdd} ">
            <li style="width: 250px"><img th:src="${pdd.goodsinfo.image}" src="attached/201881213012.jpg">
                <div><a th:text="${pdd.goodsinfo.name}" class="query" th:item-id="${pdd.goodsinfo.id}"
                        href="javascript:void(0)">魅族蓝牙小音箱</a>
                    <p th:text="${pdd.goodsinfo.level}+'成新'">商品成色</p></div>
            </li>
            <li style="width: 40px" th:text="${pdd.goodsinfo.tradingValue}">￥200</li>
            <li th:text="${pdd.userinfo.phone}">卖家联系方式</li>

            <li>
                <div th:switch="${pdd.state}">
                    <p th:case="0">卖家已取消</p>
                    <p th:case="1">等待交易</p>
                    <p th:case="2">交易结束</p>
                </div>
            </li>
            <li>
                <div th:switch="${pdd.state2}">
                    <input type="hidden" id="uid" th:value="${pdd.id}"/>
                    <input th:case="1" type="button" class="over" th:item-id="${pdd.id}" value="确认交易结束"/>
                    <p th:case="2" value="交易结束">交易结束</p>

                </div>
            </li>
            <li><span th:text="${#dates.format(pdd.modify,'yyyy-MM-dd')}">订单日期</span></li>
            <li style="width: 100px">
                <span th:if="${pdd.state==pdd.state2&&pdd.state2==2}">已完成</span>
                <span th:if="${pdd.state!=pdd.state2}" style="color: red">未完成</span>
            </li>
        </ul>
        <!--=======================================================================-->

        <script type="text/javascript">
            <!--删除-->
            $(".over").click(function () {
                var id = $(this).attr("item-id");
                $.ajax({
                    type: "post",//请求类型
                    url: "updateState2",//请求的url
                    data: {id: id},//请求参数
                    dataType: "json",//ajax接口（请求url）返回的数据类型
                    success: function (data) {//data：返回数据（json对象）
                        if (data > 0) {
                            alert("确认订单成功！");
                            history.go(0);
                        } else {
                            alert("确认订单失败！");
                        }
                    },
                    error: function (data) {//当访问时候，404，500 等非200的错误状态码
                        alert("异常，请联系管理员！！");
                    }
                });
            })
        </script>

        <div class="footer">
            <div class="footer_content">
                <ul class="footer_item">
                    <li>联系方式：</li>
                    <li class="tit">15979675043</li>
                    <li class="tit">1730548276@qq.com</li>
                </ul>

                <ul class="footer_item">
                    <li>购物指南</li>

                    <li><a href="#">选择配送方式</a></li>

                    <li><a href="#">付款收货</a></li>

                    <li><a href="#">挑选商品</a></li>

                </ul>

                <ul class="footer_item">
                    <li>送货说明</li>

                    <li><a href="#">购物流程</a></li>

                    <li><a href="#">订购方式</a></li>

                    <li><a href="#">注意事项</a></li>

                </ul>

                <ul class="footer_item">
                    <li>支付方式</li>

                    <li><a href="javascript:void(0)">货到付款区域</a></li>

                    <li><a href="javascript:void(0)">支付方式说明</a></li>

                    <li><a href="javascript:void(0)">货到付款</a></li>

                </ul>

                <ul class="footer_item">
                    <li>服务政策</li>

                    <li><a href="javascript:void(0)">售后服务</a></li>

                    <li><a href="javascript:void(0)">退换货原则</a></li>

                    <li><a href="javascript:void(0)">其他服务协议</a></li>

                </ul>

                <ul class="footer_item">
                    <li>关于我们</li>

                    <li><a href="javascript:void(0)">关于我们</a></li>

                    <li><a href="javascript:void(0)">如何联系我们</a></li>

                    <li><a href="javascript:void(0)">合作加盟</a></li>
                </ul>
            </div>
        </div>
        <div class="Shop7z_kefu">
            <div id="service">
                <ul>
                    <li>
                        <a href="javascript:void(0)" class="weixin_area">
                            <img src="images/l02.png" width="47" height="49" class="shows"/>
                            <img src="images/a.png" width="57" height="49" class="hides"/>
                            <img src="images/qd.png" width="145" class="weixin"
                                 style="display:none;margin:-100px 57px 0 0"/>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" target="_blank">
                            <div class="hides" style="width:161px;display:none;" id="qq">
                                <div class="hides" id="p1">
                                    <img src="images/ll04.png"/>
                                </div>
                                <div class="hides" id="p2"><span style="color:#FFF;font-size:13px">1599428958</span>
                                </div>
                            </div>
                            <img src="images/l04.png" width="47" height="49" class="shows"/>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)">
                            <div class="hides" style="width:161px;display:none;">
                                <div class="hides" id="p1">
                                    <img src="images/ll05.png"/>
                                </div>
                                <div class="hides" id="p3"><span style="color:#FFF;font-size:12px">12345678991</span>
                                </div>
                            </div>
                            <img src="images/l05.png" width="47" height="49" class="shows"/>
                        </a>
                    </li>
                    <li>
                        <a id="top_btn">
                            <div class="hides" style="width:161px;display:none">
                                <img src="images/ll06.png" width="161" height="49"/>
                            </div>
                            <img src="images/l06.png" width="47" height="49" class="shows"/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <script src="css/user.js"></script>

        <SCRIPT language=JavaScript>
            function changeaddr(addrname) {
                if (addrname == "addr1") {

                    document.all("address1").value = "";
                }

            }

            function mytotal(mon) {
                theForm.sendmoney.value = mon;

                if (parseFloat(theForm.freetotal.value) > 0)  //正确设置了购满金额
                {
                    if (parseFloat(theForm.freetotal.value) > parseFloat(theForm.allmoney.value)) {
                        theForm.total.value = Math.round((parseFloat(theForm.allmoney.value) + parseFloat(theForm.sendmoney.value)) * 100) / 100;
                    }
                    else {
                        theForm.total.value = Math.round(parseFloat(theForm.allmoney.value) * 100) / 100;
                        theForm.sendmoney.value = "0";
                        theForm.freedisc.value = "（购满" + theForm.freetotal.value + "元免运费）";
                    }
                }
                else {
                    theForm.total.value = Math.round((parseFloat(theForm.allmoney.value) + parseFloat(theForm.sendmoney.value)) * 100) / 100;
                }

                theForm.total.value = Math.round((parseFloat(theForm.total.value) - parseFloat(theForm.youhjmoney.value)) * 100) / 100;

            }

            function check() {
                layer.msg('对不起不能提交订单，您还没有选购任何商品!', {icon: 2});
                return (false);
            }

            function Juge() {
                if (theForm.truename.value == "") {
                    layer.msg('请填写收货人姓名', {icon: 2});
                    theForm.truename.focus();
                    return (false);
                }

                if (theForm.mobile.value == "") {
                    layer.msg('请填写移动电话', {icon: 2});
                    theForm.mobile.focus();
                    return (false);
                }

                if (theForm.address1.value == "") {
                    layer.msg('请填写收货地址', {icon: 2});
                    theForm.address1.focus();
                    return (false);
                }

                var intSelFlag = 0;

                if (typeof(theForm.sendtype.length) == "undefined") {
                    theForm.sendtype.checked = true;
                }
                else {

                    for (i = 0; i < theForm.sendtype.length; i++) {
                        if (theForm.sendtype[i].checked)  //特别这里有[i]
                        {
                            intSelFlag = 1; //选择了一个
                            break;
                        }
                    }
                    if (intSelFlag == 0) {
                        layer.msg('请选择一种配送方式', {icon: 2});
                        return (false);
                    }
                }
            }

        </script>
</body>
</html>

